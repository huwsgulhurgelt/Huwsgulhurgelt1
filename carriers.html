<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•“Ø—Ä–≥—ç–≥—á–∏–¥ - –•”©–≤—Å–≥”©–ª –•“Ø—Ä–≥—ç–ª—Ç</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="page-header">
            <a href="index.html" class="back-link">‚Üê –ë—É—Ü–∞—Ö</a>
            <h1>–ë“Ø—Ä—Ç–≥—ç–ª—Ç—ç–π —Ö“Ø—Ä–≥—ç–≥—á–∏–¥</h1>
        </header>

        <main>
            <div id="carriersContainer" class="carriers-grid">
                <p class="loading">–£–Ω—à–∏–∂ –±–∞–π–Ω–∞...</p>
            </div>
        </main>

        <footer>
            <p>–°—É—Ä–≥—É—É–ª–∏–π–Ω —Ç”©—Å”©–ª ‚Ä¢ Prototype</p>
        </footer>
    </div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, onValue, update, remove } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyArvfvF1FWfqNAJnzfNiyEq0Lm2qioPIas",
            authDomain: "huwsgul-hurgelt.firebaseapp.com",
            databaseURL: "https://huwsgul-hurgelt-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "huwsgul-hurgelt",
            storageBucket: "huwsgul-hurgelt.firebasestorage.app",
            messagingSenderId: "457877716370",
            appId: "1:457877716370:web:5bc6e08801e36010c3d54b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const carriersRef = ref(database, 'carriers');

        // Listen for realtime updates from Firebase
        onValue(carriersRef, (snapshot) => {
            const container = document.getElementById('carriersContainer');
            container.innerHTML = '';

            if (!snapshot.exists()) {
                container.innerHTML = '<p class="no-data">–û–¥–æ–æ–≥–æ–æ—Ä —Ö“Ø—Ä–≥—ç–≥—á –±“Ø—Ä—Ç–≥—ç–≥–¥—ç—ç–≥“Ø–π –±–∞–π–Ω–∞.</p>';
                return;
            }

            const carriers = snapshot.val();
            Object.keys(carriers).forEach(key => {
                const carrier = carriers[key];
                const card = createCarrierCard(key, carrier);
                container.appendChild(card);
            });
        });

        function createCarrierCard(id, carrier) {
            const card = document.createElement('div');
            card.className = 'carrier-card';
            
            // Format days for display
            const daysDisplay = carrier.days && carrier.days.length > 0 
                ? carrier.days.join(', ') 
                : '–ë“Ø—Ö ”©–¥”©—Ä';
            
            card.innerHTML = `
                <div class="card-content">
                    <div class="carrier-phone">üì± ${carrier.phone}</div>
                    <div class="carrier-description">${carrier.description}</div>
                    <div class="carrier-days">üìÖ ${daysDisplay}</div>
                </div>
                <div class="card-actions">
                    <button class="btn-small btn-edit" onclick="editCarrier('${id}', '${carrier.pin}', '${carrier.phone}', '${carrier.description.replace(/'/g, "\\'")}', '${JSON.stringify(carrier.days || [])}')">–ó–∞—Å–∞—Ö</button>
                    <button class="btn-small btn-delete" onclick="deleteCarrier('${id}', '${carrier.pin}')">–£—Å—Ç–≥–∞—Ö</button>
                </div>
            `;
            return card;
        }

        // Make functions global for onclick
        window.editCarrier = async function(id, correctPin, currentPhone, currentDescription, currentDaysJson) {
            const enteredPin = prompt('PIN –∫–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É:');
            if (!enteredPin) return;

            if (enteredPin !== correctPin) {
                alert('–ë—É—Ä—É—É PIN –∫–æ–¥!');
                return;
            }

            const newPhone = prompt('–®–∏–Ω—ç —É—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä:', currentPhone);
            if (!newPhone) return;

            const newDescription = prompt('–®–∏–Ω—ç —Ç–∞–π–ª–±–∞—Ä:', currentDescription);
            if (!newDescription) return;

            // Parse current days
            let currentDays = [];
            try {
                currentDays = JSON.parse(currentDaysJson);
            } catch (e) {
                currentDays = [];
            }

            // Create a simple days selection dialog
            const allDays = ['–î–∞–≤–∞–∞', '–ú—è–≥–º–∞—Ä', '–õ—Ö–∞–≥–≤–∞', '–ü“Ø—Ä—ç–≤', '–ë–∞–∞—Å–∞–Ω', '–ë—è–º–±–∞', '–ù—è–º'];
            const daysMessage = `–ë–æ–ª–æ–º–∂—Ç–æ–π ”©–¥—Ä“Ø“Ø–¥—ç—ç —Å–æ–Ω–≥–æ–Ω–æ —É—É (—Ç—É—Å–≥–∞–∞—Ä–ª–∞–≥—á–∞–∞—Ä: —Ç–∞—Å–ª–∞–ª)\n–ñ–∏—à—ç—ç: –î–∞–≤–∞–∞, –ú—è–≥–º–∞—Ä, –ë–∞–∞—Å–∞–Ω\n\n–û–¥–æ–æ–≥–∏–π–Ω: ${currentDays.join(', ')}`;
            const newDaysInput = prompt(daysMessage, currentDays.join(', '));
            
            if (newDaysInput === null) return;
            
            const newDays = newDaysInput.split(',').map(d => d.trim()).filter(d => d.length > 0);
            
            if (newDays.length === 0) {
                alert('–ù–∞–∞–¥ –∑–∞—Ö –Ω—å –Ω—ç–≥ ”©–¥”©—Ä —Å–æ–Ω–≥–æ–Ω–æ —É—É!');
                return;
            }

            try {
                await update(ref(database, `carriers/${id}`), {
                    phone: newPhone,
                    description: newDescription,
                    days: newDays
                });
                alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π –∑–∞—Å–∞–≥–¥–ª–∞–∞!');
            } catch (error) {
                console.error('Error:', error);
                alert('–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –î–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.');
            }
        };

        window.deleteCarrier = async function(id, correctPin) {
            const enteredPin = prompt('PIN –∫–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É:');
            if (!enteredPin) return;

            if (enteredPin !== correctPin) {
                alert('–ë—É—Ä—É—É PIN –∫–æ–¥!');
                return;
            }

            if (!confirm('“Æ–Ω—ç—Ö—ç—ç—Ä —É—Å—Ç–≥–∞—Ö —É—É?')) return;

            try {
                await remove(ref(database, `carriers/${id}`));
                alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π —É—Å—Ç–≥–∞–≥–¥–ª–∞–∞!');
            } catch (error) {
                console.error('Error:', error);
                alert('–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –î–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.');
            }
        };
    </script>
</body>
</html>
