<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–æ–ª–æ–º–∂–∏—Ç —Ö“Ø—Ä–≥—ç–≥—á–∏–¥ - –ú”©—Ä”©–Ω –•“Ø—Ä–≥—ç–ª—Ç</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Parallax Background -->
    <div class="parallax-bg">
        <div class="parallax-layer layer-1" data-speed="0.2">
            <div class="ball"></div>
            <div class="ball"></div>
            <div class="ball"></div>
            <div class="ball"></div>
        </div>
        <div class="parallax-layer layer-2" data-speed="0.5">
            <div class="ball"></div>
            <div class="ball"></div>
            <div class="ball"></div>
        </div>
        <div class="parallax-layer layer-3" data-speed="1">
            <div class="ball"></div>
            <div class="ball"></div>
            <div class="ball"></div>
        </div>
    </div>

    <div class="container">
        <header class="page-header">
            <a href="index.html" class="back-link">‚Üê –ë—É—Ü–∞—Ö</a>
            <h1>–ë–æ–ª–æ–º–∂–∏—Ç —Ö“Ø—Ä–≥—ç–≥—á–∏–¥</h1>
        </header>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="üîç –£—Ç–∞—Å, —Ç–∞–π–ª–±–∞—Ä, —ç—Å–≤—ç–ª ”©–¥—Ä”©”©—Ä —Ö–∞–π—Ö..." autocomplete="off">
                <div id="searchSuggestions" class="search-suggestions"></div>
            </div>
            <div id="searchStats" class="search-stats"></div>
        </div>

        <main id="carriersContainer" class="carriers-grid">
            <div class="loading">–£–Ω—à–∏–∂ –±–∞–π–Ω–∞...</div>
        </main>

        <footer>
            <p>–°—É—Ä–≥—É—É–ª–∏–π–Ω —Ç”©—Å”©–ª ‚Ä¢ Prototype</p>
        </footer>
    </div>

    <!-- Edit Model -->
    <div id="editModel" class="model" style="display: none;">
        <div class="model-content">
            <div class="model-header">
                <h2>–ú—ç–¥—ç—ç–ª—ç–ª –∑–∞—Å–∞—Ö</h2>
                <span class="close-model" onclick="closeEditModel()">&times;</span>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label for="editPhone">–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä</label>
                    <input type="tel" id="editPhone" required>
                </div>
                <div class="form-group">
                    <label for="editDescription">–Æ—É —Ö“Ø—Ä–≥—ç–∂ —á–∞–¥–∞—Ö –≤—ç?</label>
                    <textarea id="editDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editWeight">–•–∞–º–≥–∏–π–Ω –∏—Ö–¥—ç—ç —Ö—ç–¥—ç–Ω –∫–≥ –∑”©”©–∂ —á–∞–¥–∞—Ö –≤—ç?</label>
                    <div class="weight-slider-container">
                        <input type="range" id="editWeight" min="1" max="100" value="10" class="weight-slider">
                        <div class="weight-display">
                            <span id="editWeightValue">10</span> –∫–≥
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–•“Ø—Ä–≥—ç–ª—Ç —Ö–∏–π—Ö –±–æ–ª–æ–º–∂—Ç–æ–π ”©–¥—Ä“Ø“Ø–¥</label>
                    <div class="days-selector">
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–î–∞–≤–∞–∞"><span>–î–∞–≤–∞–∞</span></label>
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–ú—è–≥–º–∞—Ä"><span>–ú—è–≥–º–∞—Ä</span></label>
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–õ—Ö–∞–≥–≤–∞"><span>–õ—Ö–∞–≥–≤–∞</span></label>
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–ü“Ø—Ä—ç–≤"><span>–ü“Ø—Ä—ç–≤</span></label>
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–ë–∞–∞—Å–∞–Ω"><span>–ë–∞–∞—Å–∞–Ω</span></label>
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–ë—è–º–±–∞"><span>–ë—è–º–±–∞</span></label>
                        <label class="day-checkbox"><input type="checkbox" name="editDays" value="–ù—è–º"><span>–ù—è–º</span></label>
                    </div>
                </div>
                <div class="model-actions">
                    <button type="button" class="btn-cancel" onclick="closeEditModel()">–ë–æ–ª–∏—Ö</button>
                    <button type="submit" class="btn-submit">–•–∞–¥–≥–∞–ª–∞—Ö</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Parallax scroll
        window.addEventListener('scroll', () => {
            const layers = document.querySelectorAll('.parallax-layer');
            const scrolled = window.pageYOffset;
            layers.forEach(layer => {
                const speed = layer.dataset.speed;
                layer.style.transform = `translateY(${-scrolled * speed}px)`;
            });
        });
    </script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyArvfvF1FWfqNAJnzfNiyEq0Lm2qioPIas",
            authDomain: "huwsgul-hurgelt.firebaseapp.com",
            databaseURL: "https://huwsgul-hurgelt-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "huwsgul-hurgelt",
            storageBucket: "huwsgul-hurgelt.firebasestorage.app",
            messagingSenderId: "457877716370",
            appId: "1:457877716370:web:5bc6e08801e36010c3d54b"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const carriersContainer = document.getElementById('carriersContainer');
        const searchInput = document.getElementById('searchInput');
        const searchSuggestions = document.getElementById('searchSuggestions');
        const searchStats = document.getElementById('searchStats');
        const editModel = document.getElementById('editModel');
        const editForm = document.getElementById('editForm');
        const editWeightSlider = document.getElementById('editWeight');
        const editWeightValue = document.getElementById('editWeightValue');

        let allCarriers = {};
        let filteredCarriers = {};
        let currentEditId = null;

        // Weight slider update
        editWeightSlider.addEventListener('input', (e) => {
            editWeightValue.textContent = e.target.value;
        });

        // Load carriers from Firebase
        onValue(ref(database, 'carriers'), (snapshot) => {
            if (!snapshot.exists()) {
                carriersContainer.innerHTML = '<div class="no-data">–û–¥–æ–æ–≥–æ–æ—Ä —Ö“Ø—Ä–≥—ç–≥—á –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞.</div>';
                allCarriers = {};
                filteredCarriers = {};
                updateSearchStats();
                return;
            }
            allCarriers = snapshot.val();
            filteredCarriers = { ...allCarriers };
            displayCarriers(filteredCarriers);
            updateSearchStats();
        });

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            
            if (!term) {
                filteredCarriers = { ...allCarriers };
                searchSuggestions.style.display = 'none';
                displayCarriers(filteredCarriers);
                updateSearchStats();
                return;
            }

            // Filter carriers
            filteredCarriers = {};
            Object.keys(allCarriers).forEach(key => {
                const c = allCarriers[key];
                const phone = c.phone.toLowerCase();
                const desc = c.description.toLowerCase();
                const days = c.days ? c.days.join(' ').toLowerCase() : '';
                
                if (phone.includes(term) || desc.includes(term) || days.includes(term)) {
                    filteredCarriers[key] = c;
                }
            });
            
            displayCarriers(filteredCarriers);
            updateSearchStats();
        });

        // Display carriers
        function displayCarriers(carriers) {
            carriersContainer.innerHTML = '';
            
            if (!Object.keys(carriers).length) {
                carriersContainer.innerHTML = '<div class="no-data">–•–∞–π–ª—Ç–∞–¥ —Ç–æ—Ö–∏—Ä–æ—Ö —Ö“Ø—Ä–≥—ç–≥—á –æ–ª–¥—Å–æ–Ω–≥“Ø–π</div>';
                return;
            }
            
            Object.keys(carriers).forEach(id => {
                const c = carriers[id];
                const card = document.createElement('div');
                card.className = 'carrier-card';
                card.innerHTML = `
                    <div class="card-content">
                        <div class="carrier-phone">${c.phone}</div>
                        <div class="carrier-description">${c.description}</div>
                        <div class="carrier-meta">
                            <span class="carrier-days">üìÖ ${c.days ? c.days.join(', ') : '”®–¥”©—Ä —Å–æ–Ω–≥–æ–æ–≥“Ø–π'}</span>
                            ${c.maxWeight ? `<span class="carrier-weight">‚öñÔ∏è ${c.maxWeight} –∫–≥</span>` : ''}
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn-small btn-edit" onclick="editCarrier('${id}')">–ó–∞—Å–∞—Ö</button>
                        <button class="btn-small btn-delete" onclick="deleteCarrier('${id}')">–£—Å—Ç–≥–∞—Ö</button>
                    </div>
                `;
                carriersContainer.appendChild(card);
            });
        }

        // Update search stats
        function updateSearchStats() {
            const total = Object.keys(allCarriers).length;
            const showing = Object.keys(filteredCarriers).length;
            
            if (searchInput.value.trim()) {
                searchStats.innerHTML = `${showing} —Ö“Ø—Ä–≥—ç–≥—á –æ–ª–¥–ª–æ–æ (–ù–∏–π—Ç: ${total})`;
            } else {
                searchStats.innerHTML = `–ù–∏–π—Ç ${total} —Ö“Ø—Ä–≥—ç–≥—á`;
            }
        }

        // Edit carrier
        window.editCarrier = function(id) {
            const pin = prompt('PIN –∫–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É:');
            if (!pin) return;
            
            const MASTER_PIN = "4133";
            
            if (pin === MASTER_PIN || (allCarriers[id] && allCarriers[id].pin === pin)) {
                openEditModel(id);
            } else {
                alert('–ë—É—Ä—É—É PIN –∫–æ–¥!');
            }
        };

        // Open edit model
        function openEditModel(id) {
            currentEditId = id;
            const c = allCarriers[id];
            
            document.getElementById('editPhone').value = c.phone;
            document.getElementById('editDescription').value = c.description;
            editWeightSlider.value = c.maxWeight || 10;
            editWeightValue.textContent = c.maxWeight || 10;
            
            document.querySelectorAll('input[name="editDays"]').forEach(cb => {
                cb.checked = c.days && c.days.includes(cb.value);
            });
            
            editModel.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Close edit model
        window.closeEditModel = function() {
            editModel.style.display = 'none';
            document.body.style.overflow = 'auto';
            currentEditId = null;
            editForm.reset();
        };

        // Close model when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === editModel) {
                closeEditModel();
            }
        });

        // Submit edit form
        editForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const phone = document.getElementById('editPhone').value.trim();
            const desc = document.getElementById('editDescription').value.trim();
            const weight = parseInt(editWeightSlider.value);
            const days = Array.from(document.querySelectorAll('input[name="editDays"]:checked')).map(cb => cb.value);
            
            if (!days.length) {
                alert('–ù–∞–∞–¥ –∑–∞—Ö –Ω—å –Ω—ç–≥ ”©–¥”©—Ä —Å–æ–Ω–≥–æ–Ω–æ —É—É!');
                return;
            }
            
            try {
                await update(ref(database, `carriers/${currentEditId}`), {
                    phone,
                    description: desc,
                    maxWeight: weight,
                    days
                });
                alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π —à–∏–Ω—ç—á–ª—ç–≥–¥–ª—ç—ç!');
                closeEditModel();
            } catch (error) {
                console.error('Error:', error);
                alert('–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞!');
            }
        });

        // Delete carrier
        window.deleteCarrier = function(id) {
            if (!confirm('–¢–∞ —É—Å—Ç–≥–∞—Ö–¥–∞–∞ –∏—Ç–≥—ç–ª—Ç—ç–π –±–∞–π–Ω–∞ —É—É?')) return;
            
            remove(ref(database, `carriers/${id}`))
                .then(() => alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π —É—Å—Ç–≥–∞–ª–∞–∞!'))
                .catch((error) => {
                    console.error('Error:', error);
                    alert('–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞!');
                });
        };
    </script>
</body>
    </html>
