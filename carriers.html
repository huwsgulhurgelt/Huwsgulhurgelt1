<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•“Ø—Ä–≥—ç–≥—á–∏–¥ - –•”©–≤—Å–≥”©–ª –•“Ø—Ä–≥—ç–ª—Ç</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="page-header">
            <a href="index.html" class="back-link">‚Üê –ë—É—Ü–∞—Ö</a>
            <h1>–ë“Ø—Ä—Ç–≥—ç–ª—Ç—ç–π —Ö“Ø—Ä–≥—ç–≥—á–∏–¥</h1>
        </header>

        <main>
            <div id="carriersContainer" class="carriers-grid">
                <p class="loading">–£–Ω—à–∏–∂ –±–∞–π–Ω–∞...</p>
            </div>
        </main>

        <footer>
            <p>–°—É—Ä–≥—É—É–ª–∏–π–Ω —Ç”©—Å”©–ª ‚Ä¢ Prototype</p>
        </footer>
    </div>

    <script>
        function loadCarriers() {
            const container = document.getElementById('carriersContainer');
            const carriers = JSON.parse(localStorage.getItem('carriers') || '[]');

            if (carriers.length === 0) {
                container.innerHTML = '<p class="no-data">–û–¥–æ–æ–≥–æ–æ—Ä —Ö“Ø—Ä–≥—ç–≥—á –±“Ø—Ä—Ç–≥—ç–≥–¥—ç—ç–≥“Ø–π –±–∞–π–Ω–∞.</p>';
                return;
            }

            container.innerHTML = '';
            carriers.forEach(carrier => {
                const card = createCarrierCard(carrier);
                container.appendChild(card);
            });
        }

        function createCarrierCard(carrier) {
            const card = document.createElement('div');
            card.className = 'carrier-card';
            card.innerHTML = `
                <div class="card-content">
                    <div class="carrier-phone">üì± ${carrier.phone}</div>
                    <div class="carrier-description">${carrier.description}</div>
                </div>
                <div class="card-actions">
                    <button class="btn-small btn-edit" onclick="editCarrier('${carrier.id}', '${carrier.pin}', '${carrier.phone}', '${carrier.description.replace(/'/g, "\\'")}')">–ó–∞—Å–∞—Ö</button>
                    <button class="btn-small btn-delete" onclick="deleteCarrier('${carrier.id}', '${carrier.pin}')">–£—Å—Ç–≥–∞—Ö</button>
                </div>
            `;
            return card;
        }

        window.editCarrier = function(id, correctPin, currentPhone, currentDescription) {
            const enteredPin = prompt('PIN –∫–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É:');
            if (!enteredPin) return;

            if (enteredPin !== correctPin) {
                alert('–ë—É—Ä—É—É PIN –∫–æ–¥!');
                return;
            }

            const newPhone = prompt('–®–∏–Ω—ç —É—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä:', currentPhone);
            if (!newPhone) return;

            const newDescription = prompt('–®–∏–Ω—ç —Ç–∞–π–ª–±–∞—Ä:', currentDescription);
            if (!newDescription) return;

            let carriers = JSON.parse(localStorage.getItem('carriers') || '[]');
            const index = carriers.findIndex(c => c.id === id);
            
            if (index !== -1) {
                carriers[index].phone = newPhone;
                carriers[index].description = newDescription;
                localStorage.setItem('carriers', JSON.stringify(carriers));
                window.dispatchEvent(new Event('storage'));
                loadCarriers();
                alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π –∑–∞—Å–∞–≥–¥–ª–∞–∞!');
            }
        };

        window.deleteCarrier = function(id, correctPin) {
            const enteredPin = prompt('PIN –∫–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É:');
            if (!enteredPin) return;

            if (enteredPin !== correctPin) {
                alert('–ë—É—Ä—É—É PIN –∫–æ–¥!');
                return;
            }

            if (!confirm('“Æ–Ω—ç—Ö—ç—ç—Ä —É—Å—Ç–≥–∞—Ö —É—É?')) return;

            let carriers = JSON.parse(localStorage.getItem('carriers') || '[]');
            carriers = carriers.filter(c => c.id !== id);
            localStorage.setItem('carriers', JSON.stringify(carriers));
            window.dispatchEvent(new Event('storage'));
            loadCarriers();
            alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π —É—Å—Ç–≥–∞–≥–¥–ª–∞–∞!');
        };

        // Listen for storage changes (realtime updates across tabs)
        window.addEventListener('storage', loadCarriers);
        
        // Custom event for same-tab updates
        window.addEventListener('storage', loadCarriers);

        // Load carriers on page load
        loadCarriers();
    </script>
</body>
</html>
